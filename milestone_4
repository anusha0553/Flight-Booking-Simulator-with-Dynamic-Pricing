<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flight Booking Simulator</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h2 { color: #333; }
table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background-color: #f4f4f4; }
button { padding: 6px 12px; margin: 2px; cursor: pointer; }
input, select { padding: 5px; margin: 5px 0; width: 100%; }
.container { max-width: 600px; margin: auto; }
.hidden { display: none; }
</style>
</head>
<body>
<div class="container">
<h2>Flight Booking Simulator</h2>
<h3>Available Flights</h3>
<table id="flightsTable">
<thead>
<tr>
<th>Flight ID</th><th>Airline</th><th>From</th><th>To</th>
<th>Departure</th><th>Arrival</th><th>Price</th><th>Seats</th><th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>
<div id="bookingForm" class="hidden">
<h3>Booking Flight: <span id="selectedFlight"></span></h3>
<label>Seat Number:</label>
<input type="text" id="seatNo" placeholder="e.g., 12A">
<label>First Name:</label>
<input type="text" id="firstName">
<label>Last Name:</label>
<input type="text" id="lastName">
<label>Age:</label>
<input type="number" id="age">
<label>Phone:</label>
<input type="text" id="phone">
<button type="button" onclick="startBooking()">Start Booking</button>
</div>
<div id="bookingResult" class="hidden">
<h3>Booking Reserved</h3>
<p>Reservation ID: <span id="resId"></span></p>
<p>PNR: <span id="pnr"></span></p>
<p>Status: <span id="status"></span></p>
<p>Price: <span id="price"></span></p>
<button type="button" onclick="confirmBooking()">Confirm Booking</button>
<button type="button" onclick="cancelBooking()">Cancel Booking</button>
</div>
<div id="historySection">
<h3>Booking History</h3>
<label>Enter PNR:</label>
<input type="text" id="historyPnr">
<button onclick="getHistory()">Get History</button>
<pre id="historyResult"></pre>
</div>
</div>
<script>
const API_BASE = "http://127.0.0.1:8000";
let selectedFlightId = "";
let currentReservationId = "";

async function loadFlights() {
    let res = await fetch(`${API_BASE}/flights`);
    let flights = await res.json();
    let tbody = document.querySelector("#flightsTable tbody");
    tbody.innerHTML = "";
    flights.forEach(f => {
        let tr = document.createElement("tr");
        tr.innerHTML = `
        <td>${f.flight_id}</td>
        <td>${f.airline_name}</td>
        <td>${f.origin}</td>
        <td>${f.destination}</td>
        <td>${f.departure_time}</td>
        <td>${f.arrival_time}</td>
        <td>${f.base_fare}</td>
        <td>${f.seats_available}</td>
        <td><button onclick="selectFlight('${f.flight_id}')">Book</button></td>
        `;
        tbody.appendChild(tr);
    });
}
function selectFlight(flightId) {
    selectedFlightId = flightId;
    document.getElementById("selectedFlight").innerText = flightId;
    document.getElementById("bookingForm").classList.remove("hidden");
    document.getElementById("bookingResult").classList.add("hidden");
}
async function startBooking() {
    let seatNo = document.getElementById("seatNo").value;
    let passenger = {
        first_name: document.getElementById("firstName").value,
        last_name: document.getElementById("lastName").value,
        age: parseInt(document.getElementById("age").value),
        phone: document.getElementById("phone").value
    };

    let res = await fetch(`${API_BASE}/bookings/start`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            flight_id: selectedFlightId,
            seat_no: seatNo,
            passenger,
            travel_date: new Date().toISOString().split("T")[0]
        })
    });
    let data = await res.json();
    console.log(data);
    alert(`Reservation Created! Reservation ID: ${data.reservation_id}`);
    currentReservationId = data.reservation_id;
    document.getElementById("resId").innerText = data.reservation_id;
    document.getElementById("pnr").innerText = data.pnr || "Not yet confirmed";
    document.getElementById("status").innerText = data.status;
    document.getElementById("price").innerText = data.price;
    document.getElementById("bookingForm").classList.add("hidden");
    document.getElementById("bookingResult").classList.remove("hidden");
    document.getElementById("historySection").classList.remove("hidden");

}
async function confirmBooking() {
    let res = await fetch(`${API_BASE}/bookings/confirm`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ reservation_id: currentReservationId })
    });
    let data = await res.json();
    document.getElementById("pnr").innerText = data.pnr;
    document.getElementById("status").innerText = data.status;
    alert("Booking Confirmed!");
}
async function cancelBooking() {
    let res = await fetch(`${API_BASE}/bookings/cancel`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ reservation_id: currentReservationId })
    });
    let data = await res.json();
    document.getElementById("status").innerText = data.status;
    alert("Booking Cancelled!");
    resetBookingForm();
    document.getElementById("seatNo").value = "";
    document.getElementById("firstName").value = "";
    document.getElementById("lastName").value = "";
    document.getElementById("age").value = "";
    document.getElementById("phone").value = "";
    document.getElementById("bookingResult").classList.add("hidden");
    document.getElementById("bookingForm").classList.add("hidden");
    document.getElementById("historySection").classList.remove("hidden");
}
async function getHistory() {
    let pnr = document.getElementById("historyPnr").value;
    let res = await fetch(`${API_BASE}/bookings/history/${pnr}`);
    let data = await res.json();
    document.getElementById("historyResult").innerText = JSON.stringify(data, null, 2);
}
function resetBookingForm() {
    document.getElementById("bookingForm").classList.add("hidden");
    document.getElementById("bookingResult").classList.add("hidden");
    document.getElementById("historySection").classList.remove("hidden");
    document.getElementById("seatNo").value = "";
    document.getElementById("firstName").value = "";
    document.getElementById("lastName").value = "";
    document.getElementById("age").value = "";
    document.getElementById("phone").value = "";
}
loadFlights();
</script>
</body>
</html>
